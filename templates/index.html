<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Personal website and blog of {{ cv.personal_info.name }} showcasing projects, skills, and thoughts on technology.">
    <meta name="keywords" content="developer, portfolio, blog, projects, technology, {{ cv.personal_info.title }}">
    <meta name="author" content="{{ cv.personal_info.name }}">
    <meta name="theme-color" content="#286983">
    <title>{{ cv.personal_info.name }} - Blog & Portfolio</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header>
        <div class="container">
            <a href="index.html" class="logo">
                <h1>{{ cv.personal_info.name }}</h1>
            </a>
            <nav aria-label="Main navigation">
                <ul>
                    <li><a href="index.html" aria-current="page">Blog</a></li>
                    <li><a href="cv.html">CV</a></li>
                    <li><a href="#projects">Projects</a></li>
                </ul>
                <div class="theme-switch-wrapper">
                    <label class="theme-switch" for="checkbox" title="Toggle dark/light theme">
                        <input type="checkbox" id="checkbox" />
                        <div class="slider round"></div>
                    </label>
                    <em id="theme-label">Light Mode</em>
                </div>
            </nav>
        </div>
    </header>

    <main id="main-content">
        <section class="intro-section" id="introduction">
            <div class="container">
                <article class="blog-card intro">
                    <div class="blog-card-content">
                        <h3 class="blog-title">Welcome to My Blog & Portfolio</h3>
                        <p class="blog-excerpt">
                            Hello and welcome! I'm a Data Engineer with a passion for functional programming, 
                            big data technologies, and compiler design. This blog is where I share my thoughts, 
                            projects, and experiences in the world of software development.
                        </p>
                        <p class="blog-excerpt">
                            Feel free to explore my projects, read my blog posts, or get in touch if you'd like 
                            to collaborate or just chat about technology.
                        </p>
                    </div>
                </article>
            </div>
        </section>

        <section class="featured-post" id="blog">
            <div class="container">
                <h2 class="section-title">Latest Posts</h2>
                <article class="blog-card featured">
                    <div class="blog-card-content">
                        <div class="blog-meta">
                            <span class="blog-date" data-date="2023-06-15">June 15, 2023</span>
                            <span class="blog-category">Technology</span>
                        </div>
                        <h3 class="blog-title">Getting Started with Rust and Functional Programming</h3>
                        <p class="blog-excerpt">
                            Rust combines the performance of low-level languages with the safety of high-level ones. 
                            In this post, I explore how to apply functional programming principles in Rust...
                        </p>
                        <a href="#" class="read-more">Read More <i class="fas fa-arrow-right"></i></a>
                    </div>
                    <div class="blog-image">
                        <img src="https://via.placeholder.com/600x400" alt="Rust Programming" />
                    </div>
                </article>
            </div>
        </section>

        <section class="blog-posts">
            <div class="container">
                <div class="blog-grid">
                    <article class="blog-card">
                        <div class="blog-meta">
                            <span class="blog-date" data-date="2023-05-28">May 28, 2023</span>
                            <span class="blog-category">Development</span>
                        </div>
                        <h3 class="blog-title">Building Responsive Web Applications</h3>
                        <p class="blog-excerpt">
                            Modern web applications need to work on devices of all sizes. Here's my approach to creating 
                            truly responsive experiences...
                        </p>
                        <a href="#" class="read-more">Read More <i class="fas fa-arrow-right"></i></a>
                    </article>

                    <article class="blog-card">
                        <div class="blog-meta">
                            <span class="blog-date" data-date="2023-04-12">April 12, 2023</span>
                            <span class="blog-category">Career</span>
                        </div>
                        <h3 class="blog-title">Transitioning from Data Science to Engineering</h3>
                        <p class="blog-excerpt">
                            My journey from analyzing data to building the systems that process it. Lessons learned and 
                            skills that transferred...
                        </p>
                        <a href="#" class="read-more">Read More <i class="fas fa-arrow-right"></i></a>
                    </article>

                    <article class="blog-card">
                        <div class="blog-meta">
                            <span class="blog-date" data-date="2023-03-05">March 5, 2023</span>
                            <span class="blog-category">Tools</span>
                        </div>
                        <h3 class="blog-title">My Development Environment Setup</h3>
                        <p class="blog-excerpt">
                            A detailed look at the tools, extensions, and configurations I use to maximize productivity 
                            in my daily work...
                        </p>
                        <a href="#" class="read-more">Read More <i class="fas fa-arrow-right"></i></a>
                    </article>
                </div>
            </div>
        </section>

        <section class="featured-projects" id="projects">
            <div class="container">
                <h2 class="section-title">Featured Projects</h2>
                <div class="projects-grid" id="featured-projects">
                    <!-- Projects will be dynamically populated by JavaScript -->
                </div>
            </div>
        </section>

        <section class="about" id="about">
            <div class="container">
                <div class="about-content">
                    <h2 class="section-title">About Me</h2>
                    <p>{{ cv.personal_info.summary }}</p>
                </div>
            </div>
        </section>

        <section class="contact" id="contact">
            <div class="container">
                <h2 class="section-title">Get In Touch</h2>
                <p>Feel free to reach out to me at <a href="mailto:{{ cv.personal_info.email }}" id="email">{{ cv.personal_info.email }}</a></p>
                <div class="social-links" id="social-links">
                    {% for entry in cv.personal_info.social_links %}
                    <a href="{{ entry.1 }}" class="social-link" target="_blank" rel="noopener" aria-label="{{ entry.0 }} profile">
                        <i class="fab fa-{{ entry.0 | lower }}"></i>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-nav">
                    <h3>Navigation</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="cv.html">CV</a></li>
                        <li><a href="#blog">Blog</a></li>
                        <li><a href="#projects">Projects</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-social">
                    <h3>Connect</h3>
                    <div class="social-links">
                        {% for entry in cv.personal_info.social_links %}
                        <a href="{{ entry.1 }}" class="social-link" target="_blank" rel="noopener" aria-label="{{ entry.0 }} profile">
                            <i class="fab fa-{{ entry.0 | lower }}"></i>
                        </a>
                        {% endfor %}
                    </div>
                </div>
                <div class="footer-tech">
                    <h3>Built With</h3>
                    <ul class="tech-list">
                        <li><i class="fab fa-rust"></i> Rust - Static site generation</li>
                        <li><i class="fas fa-file-pdf"></i> Typst - PDF resume creation</li>
                        <li><i class="fas fa-box"></i> Dependencies - im, serde, tera</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; <span id="current-year">2023</span> {{ cv.personal_info.name }}. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Update the current year
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // Format blog dates
        document.querySelectorAll('.blog-date[data-date]').forEach(dateElement => {
            const dateStr = dateElement.getAttribute('data-date');
            const date = new Date(dateStr);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            dateElement.textContent = date.toLocaleDateString('en-US', options);
        });

        // Theme switcher functionality
        const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
        const themeLabel = document.getElementById('theme-label');

        // Function to set a theme
        function setTheme(theme) {
            document.documentElement.className = theme;
            localStorage.setItem('theme', theme);

            if (theme === 'theme-dark') {
                toggleSwitch.checked = true;
                themeLabel.textContent = 'Dark Mode';
            } else {
                toggleSwitch.checked = false;
                themeLabel.textContent = 'Light Mode';
            }
        }

        // Check for saved theme preference or use system preference
        const currentTheme = localStorage.getItem('theme') || 
            (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'theme-dark' : 'theme-light');

        // Apply the theme
        setTheme(currentTheme);

        // Listen for theme toggle
        toggleSwitch.addEventListener('change', function(e) {
            if (e.target.checked) {
                setTheme('theme-dark');
            } else {
                setTheme('theme-light');
            }
        });

        // GitHub API integration with fallback for rate limiting
        async function fetchGitHubRepos() {
            const projectsContainer = document.getElementById('featured-projects');

            // Define the repositories to fetch
            const repos = [
                { owner: 'hakimjonas', repo: 'valar', language: 'scala' },
                { owner: 'hakimjonas', repo: 'fin', language: 'rust' },
                { owner: 'fungal-lang', repo: 'spore-print', language: 'rust' }
            ];

            // Fallback data to use when GitHub API is rate limited
            const fallbackData = [
                {
                    owner: 'hakimjonas',
                    repo: 'valar',
                    language: 'scala',
                    description: 'Valar: Type-safe validation for Scala 3 with boilerplate-free derivation via macros. Features error accumulation and fail-fast modes.',
                    stars: 2,
                    avatar_url: 'https://avatars.githubusercontent.com/u/3774539?v=4',
                    login: 'hakimjonas'
                },
                {
                    owner: 'hakimjonas',
                    repo: 'fin',
                    language: 'rust',
                    description: 'Finë is a simple, GTK4-based session transition tool for Linux desktops—built in Rust with a functional, modular design.',
                    stars: 2,
                    avatar_url: 'https://avatars.githubusercontent.com/u/3774539?v=4',
                    login: 'hakimjonas'
                },
                {
                    owner: 'fungal-lang',
                    repo: 'spore-print',
                    language: 'rust',
                    description: 'A Rust library providing a SporePrint trait and derive macro for immutable string representations.',
                    stars: 0,
                    avatar_url: 'https://avatars.githubusercontent.com/u/168653203?v=4',
                    login: 'fungal-lang'
                }
            ];

            try {
                // Clear any existing content
                projectsContainer.innerHTML = '';

                // Try to fetch from GitHub API first
                let useApi = true;
                let apiData = [];

                try {
                    for (const repoInfo of repos) {
                        // Fetch repository data from GitHub API
                        const response = await fetch(`https://api.github.com/repos/${repoInfo.owner}/${repoInfo.repo}`);
                        if (!response.ok) {
                            if (response.status === 403) {
                                console.warn('GitHub API rate limit exceeded, using fallback data');
                                useApi = false;
                                break;
                            }
                            throw new Error(`GitHub API error: ${response.status}`);
                        }
                        const repo = await response.json();

                        // Fetch user data for avatar
                        const userResponse = await fetch(`https://api.github.com/users/${repoInfo.owner}`);
                        if (!userResponse.ok) {
                            if (userResponse.status === 403) {
                                console.warn('GitHub API rate limit exceeded, using fallback data');
                                useApi = false;
                                break;
                            }
                            throw new Error(`GitHub API error: ${userResponse.status}`);
                        }
                        const user = await userResponse.json();

                        apiData.push({
                            owner: repoInfo.owner,
                            repo: repoInfo.repo,
                            language: repoInfo.language,
                            description: repo.description || 'No description available',
                            stars: repo.stargazers_count,
                            avatar_url: user.avatar_url,
                            login: user.login
                        });
                    }
                } catch (apiError) {
                    console.error('Error fetching from GitHub API:', apiError);
                    useApi = false;
                }

                // Use either API data or fallback data
                const dataToUse = useApi ? apiData : fallbackData;

                // Create cards for each repository
                for (const data of dataToUse) {
                    // Create GitHub card element
                    const card = document.createElement('article');
                    card.className = 'github-card';

                    // Create card header
                    const header = document.createElement('div');
                    header.className = `card-header ${data.language}`;

                    // Create repo info
                    const repoInfoDiv = document.createElement('div');
                    repoInfoDiv.className = 'repo-info';
                    const repoSpan = document.createElement('span');
                    repoSpan.textContent = `${data.owner}/${data.repo}`;
                    repoInfoDiv.appendChild(repoSpan);

                    // Create stars info
                    const starsDiv = document.createElement('div');
                    starsDiv.className = 'stars';
                    const starCount = document.createElement('span');
                    starCount.className = 'star-count';
                    starCount.textContent = data.stars;
                    const starIcon = document.createElement('i');
                    starIcon.className = 'fas fa-star';
                    starsDiv.appendChild(starCount);
                    starsDiv.appendChild(starIcon);

                    // Add repo info and stars to header
                    header.appendChild(repoInfoDiv);
                    header.appendChild(starsDiv);

                    // Create repo description
                    const description = document.createElement('p');
                    description.className = 'repo-description';
                    description.textContent = data.description;

                    // Create GitHub link
                    const linkContainer = document.createElement('div');
                    linkContainer.className = 'project-links';

                    const githubLink = document.createElement('a');
                    githubLink.className = 'project-link';
                    githubLink.href = `https://github.com/${data.owner}/${data.repo}`;
                    githubLink.target = '_blank';
                    githubLink.rel = 'noopener';

                    const githubIcon = document.createElement('i');
                    githubIcon.className = 'fab fa-github';

                    githubLink.appendChild(githubIcon);
                    githubLink.appendChild(document.createTextNode(' View on GitHub'));

                    linkContainer.appendChild(githubLink);

                    // Create card footer
                    const footer = document.createElement('div');
                    footer.className = 'card-footer';

                    // Create avatar
                    const avatar = document.createElement('img');
                    avatar.className = 'avatar';
                    avatar.src = data.avatar_url;
                    avatar.alt = data.login;

                    // Create owner name
                    const ownerName = document.createElement('span');
                    ownerName.textContent = data.login;

                    // Add avatar and owner name to footer
                    footer.appendChild(avatar);
                    footer.appendChild(ownerName);

                    // Add all elements to card
                    card.appendChild(header);
                    card.appendChild(description);
                    card.appendChild(linkContainer);
                    card.appendChild(footer);

                    // Add card to projects container
                    projectsContainer.appendChild(card);
                }

                // If we're using fallback data, add a note
                if (!useApi) {
                    const noteDiv = document.createElement('div');
                    noteDiv.className = 'api-note';
                    noteDiv.style.textAlign = 'center';
                    noteDiv.style.marginTop = '1rem';
                    noteDiv.style.fontSize = '0.9rem';
                    noteDiv.style.color = 'var(--light-text)';
                    noteDiv.textContent = 'Note: Using cached project data due to GitHub API rate limits.';
                    projectsContainer.appendChild(noteDiv);
                }
            } catch (error) {
                console.error('Error in project display:', error);
                projectsContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <p>Unable to load projects at this time.</p>
                        <p style="font-size: 0.9rem; color: var(--light-text);">
                            Please check back later or visit 
                            <a href="https://github.com/hakimjonas" target="_blank" rel="noopener">GitHub</a> 
                            directly to see my work.
                        </p>
                    </div>
                `;
            }
        }

        // Load GitHub repositories when the page is loaded
        document.addEventListener('DOMContentLoaded', fetchGitHubRepos);
    </script>
</body>
</html>
