<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog API Debug</title>
    <style>
        body {
            font-family: monospace;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1, h2 {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
        textarea {
            width: 100%;
            height: 300px;
            font-family: monospace;
            margin-bottom: 10px;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #result {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Blog API Debug</h1>
    <p id="api-url">Connecting to API...</p>

    <h2>Create Post</h2>
    <p>Edit the JSON below to create a new blog post:</p>

    <textarea id="postJson">{
  "title": "Test Post",
  "slug": "test-post",
  "date": "2025-06-12",
  "author": "Test Author",
  "excerpt": "This is a test excerpt",
  "content": "This is the full content of the test post.",
  "published": true,
  "featured": false,
  "image": null,
  "tags": [
    {
      "name": "Test",
      "slug": "test"
    }
  ],
  "metadata": {}
}</textarea>

    <button id="createPostBtn">Create Post</button>

    <div id="result"></div>

    <h2>All Posts</h2>
    <button id="getAllPostsBtn">Get All Posts</button>
    <div id="postsResult"></div>

    <script src="/static/js/api-client.js"></script>
    <script>
        // Display the current API URL
        document.getElementById('api-url').textContent = `API URL: ${BlogAPI.getBaseUrl()}`;
        // Function to create a post
        async function createPost() {
            console.log('Create post button clicked');
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Processing request...</p>';
            const jsonText = document.getElementById('postJson').value;

            try {
                // Parse JSON to ensure it's valid
                const postData = JSON.parse(jsonText);

                // Ensure all required fields are present
                if (!postData.title || !postData.slug || !postData.content || !postData.date || !postData.author) {
                    throw new Error('Missing required fields: title, slug, content, date, author must be non-empty');
                }

                // Log the data being sent
                console.log('Sending post data:', postData);
                resultDiv.innerHTML += '<p>Sending request to server...</p>';

                // Use our API client instead of fetch directly
                try {
                    const responseData = await BlogAPI.createPost(postData);
                    resultDiv.innerHTML = `
                        <h3 class="success">Success</h3>
                        <pre>${JSON.stringify(responseData, null, 2)}</pre>
                    `;
                    console.log('Request completed successfully');
                } catch (error) {
                    resultDiv.innerHTML = `
                        <h3 class="error">Error</h3>
                        <p>${error.status ? `Status: ${error.status}` : ''}</p>
                        <pre>${error.toString()}</pre>
                    `;

                    if (error.response) {
                        resultDiv.innerHTML += `<p>Response data:</p><pre>${JSON.stringify(error.response, null, 2)}</pre>`;
                    }
                    console.log('Request completed with error');
                }

                // Detailed response logging is now handled by the BlogAPI client

            } catch (error) {
                resultDiv.innerHTML = `
                    <h3 class="error">Exception</h3>
                    <pre>${error.toString()}</pre>
                `;
                console.error('Error creating post:', error);
            }
        }

        // Function to get all posts
        async function getAllPosts() {
            const postsResultDiv = document.getElementById('postsResult');
            postsResultDiv.innerHTML = '<p>Loading posts...</p>';

            try {
                // Use our API client
                const posts = await BlogAPI.getPosts();
                postsResultDiv.innerHTML = `
                    <h3 class="success">Success</h3>
                    <p>Found ${posts.length} posts</p>
                    <pre>${JSON.stringify(posts, null, 2)}</pre>
                `;
            } catch (error) {
                postsResultDiv.innerHTML = `
                    <h3 class="error">Error</h3>
                    <p>${error.status ? `Status: ${error.status}` : ''}</p>
                    <pre>${error.toString()}</pre>
                `;

                if (error.response) {
                    postsResultDiv.innerHTML += `<p>Response data:</p><pre>${JSON.stringify(error.response, null, 2)}</pre>`;
                }

                console.error('Error getting posts:', error);
            }
        }

        // Add event listeners
        document.getElementById('createPostBtn').addEventListener('click', createPost);
        document.getElementById('getAllPostsBtn').addEventListener('click', getAllPosts);
    </script>
</body>
</html>
