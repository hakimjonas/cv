<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Client</title>
    <!-- EasyMDE Markdown Editor CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.css">
    <style>
        /* Base styles with improved color scheme */
        :root {
            --primary-color: #3498db;
            --primary-dark: #2980b9;
            --secondary-color: #2c3e50;
            --secondary-dark: #1a252f;
            --accent-color: #f39c12;
            --accent-dark: #e67e22;
            --danger-color: #e74c3c;
            --danger-dark: #c0392b;
            --success-color: #2ecc71;
            --text-color: #333;
            --text-light: #7f8c8d;
            --bg-color: #f7f7f7;
            --card-bg: white;
            --border-color: #ddd;
            --shadow-color: rgba(0,0,0,0.1);
            --border-radius-sm: 4px;
            --border-radius-md: 6px;
            --border-radius-lg: 8px;
            --spacing-xs: 5px;
            --spacing-sm: 10px;
            --spacing-md: 15px;
            --spacing-lg: 20px;
            --spacing-xl: 30px;
            --font-size-xs: 0.8rem;
            --font-size-sm: 0.9rem;
            --font-size-md: 1rem;
            --font-size-lg: 1.2rem;
            --font-size-xl: 1.5rem;
            --transition-speed: 0.3s;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            color: var(--text-color);
            background-color: var(--bg-color);
            transition: background-color var(--transition-speed) ease;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-lg);
        }

        header {
            background-color: var(--secondary-color);
            color: white;
            padding: var(--spacing-lg);
            text-align: center;
            box-shadow: 0 2px 10px var(--shadow-color);
            margin-bottom: var(--spacing-lg);
        }

        header h1 {
            margin: 0;
            font-size: var(--font-size-xl);
        }

        /* Blog posts grid */
        .blog-posts {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-lg);
        }

        .blog-post {
            background-color: var(--card-bg);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 3px 10px var(--shadow-color);
            padding: var(--spacing-lg);
            transition: transform var(--transition-speed) ease, 
                        box-shadow var(--transition-speed) ease;
            border: 1px solid var(--border-color);
        }

        .blog-post:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--shadow-color);
        }

        .blog-post h2 {
            margin-top: 0;
            color: var(--secondary-color);
            font-size: var(--font-size-lg);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: var(--spacing-xs);
            margin-bottom: var(--spacing-sm);
        }

        .post-meta {
            color: var(--text-light);
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-md);
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
            align-items: center;
        }

        .tag {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 3px 10px;
            border-radius: var(--border-radius-sm);
            margin-right: var(--spacing-xs);
            font-size: var(--font-size-xs);
            transition: background-color var(--transition-speed) ease;
        }

        .tag:hover {
            background-color: var(--primary-dark);
        }

        .post-actions {
            display: flex;
            justify-content: flex-start;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-lg);
        }

        /* Button styles */
        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: var(--font-size-sm);
            transition: background-color var(--transition-speed) ease, 
                        transform var(--transition-speed) ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            font-weight: 500;
        }

        button:hover {
            background-color: var(--secondary-dark);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .view-btn {
            background-color: var(--secondary-color);
        }

        .edit-btn {
            background-color: var(--accent-color);
        }

        .edit-btn:hover {
            background-color: var(--accent-dark);
        }

        .delete-btn {
            background-color: var(--danger-color);
        }

        .delete-btn:hover {
            background-color: var(--danger-dark);
        }

        /* Form styles */
        .form-container {
            background-color: var(--card-bg);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 3px 10px var(--shadow-color);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            border: 1px solid var(--border-color);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: bold;
            color: var(--secondary-color);
        }

        input, textarea, select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-md);
            transition: border-color var(--transition-speed) ease, 
                        box-shadow var(--transition-speed) ease;
            background-color: white;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
        }

        .checkbox-group input {
            width: auto;
            margin-right: var(--spacing-sm);
        }

        /* Status messages */
        .loading {
            text-align: center;
            padding: var(--spacing-lg);
            font-style: italic;
            color: var(--text-light);
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: var(--border-radius-md);
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .error {
            background-color: var(--danger-color);
            color: white;
            padding: var(--spacing-md);
            border-radius: var(--border-radius-sm);
            margin-bottom: var(--spacing-md);
            box-shadow: 0 2px 5px rgba(231, 76, 60, 0.3);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .error::before {
            content: "⚠️";
            font-size: var(--font-size-lg);
        }

        .success {
            background-color: var(--success-color);
            color: white;
            padding: var(--spacing-md);
            border-radius: var(--border-radius-sm);
            margin-bottom: var(--spacing-md);
            box-shadow: 0 2px 5px rgba(46, 204, 113, 0.3);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .success::before {
            content: "✓";
            font-size: var(--font-size-lg);
            font-weight: bold;
        }

        /* Tab navigation */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: var(--spacing-lg);
            gap: 2px;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            background-color: var(--bg-color);
            border: 1px solid transparent;
            transition: all var(--transition-speed) ease;
            font-weight: 500;
            color: var(--text-light);
            border-radius: var(--border-radius-sm) var(--border-radius-sm) 0 0;
        }

        .tab:hover {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
        }

        .tab.active {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-bottom-color: var(--card-bg);
            color: var(--primary-color);
            font-weight: bold;
            margin-bottom: -1px;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Authentication styles */
        .auth-status {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-md);
            background-color: var(--card-bg);
            border-radius: var(--border-radius-sm);
            box-shadow: 0 2px 5px var(--shadow-color);
            border: 1px solid var(--border-color);
        }
        
        .auth-status-message {
            margin-right: var(--spacing-sm);
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .auth-button {
            margin-left: var(--spacing-sm);
            background-color: var(--primary-color);
        }
        
        .auth-button:hover {
            background-color: var(--primary-dark);
        }
        
        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .user-info {
            margin-top: var(--spacing-lg);
            padding: var(--spacing-md);
            background-color: var(--card-bg);
            border-radius: var(--border-radius-sm);
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        
        .user-info h3 {
            margin-top: 0;
            color: var(--secondary-color);
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-md);
        }
        
        .user-info p {
            margin: var(--spacing-xs) 0;
            color: var(--text-color);
        }
        
        .user-role {
            display: inline-block;
            padding: 4px 10px;
            background-color: var(--primary-color);
            color: white;
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-xs);
            margin-top: var(--spacing-xs);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Radio button group styling */
        .radio-group {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-xs);
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: normal;
            padding: 5px 10px;
            border-radius: var(--border-radius-sm);
            transition: background-color var(--transition-speed) ease;
        }
        
        .radio-group label:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .radio-group input[type="radio"] {
            margin-right: var(--spacing-xs);
            accent-color: var(--primary-color);
        }
        
        /* Markdown editor customization */
        .CodeMirror {
            border: 1px solid var(--border-color);
            border-radius: 0 0 var(--border-radius-sm) var(--border-radius-sm);
            height: 400px;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 15px;
            line-height: 1.6;
            transition: border-color var(--transition-speed) ease;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .CodeMirror:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .CodeMirror-focused {
            border-color: var(--primary-color);
        }
        
        /* Syntax highlighting improvements */
        .cm-s-easymde .cm-header {
            color: var(--primary-dark);
            font-weight: bold;
        }
        
        .cm-s-easymde .cm-strong {
            color: #d33682;
            font-weight: bold;
        }
        
        .cm-s-easymde .cm-em {
            color: #2aa198;
            font-style: italic;
        }
        
        .cm-s-easymde .cm-link {
            color: var(--primary-color);
            text-decoration: underline;
        }
        
        .cm-s-easymde .cm-url {
            color: #6c71c4;
        }
        
        .cm-s-easymde .cm-quote {
            color: #859900;
            font-style: italic;
        }
        
        .cm-s-easymde .cm-comment {
            color: #93a1a1;
        }
        
        .cm-s-easymde .cm-tag {
            color: #268bd2;
        }
        
        /* Editor toolbar enhancements */
        .editor-toolbar {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm) var(--border-radius-sm) 0 0;
            background-color: #f8f9fa;
            padding: 5px;
            opacity: 1;
            transition: opacity var(--transition-speed) ease;
        }
        
        .editor-toolbar:hover {
            opacity: 1;
        }
        
        .editor-toolbar button {
            color: var(--text-color);
            background: transparent;
            border: 1px solid transparent;
            border-radius: var(--border-radius-sm);
            transition: all var(--transition-speed) ease;
            margin: 0 2px;
            padding: 8px;
            width: 36px;
            height: 36px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .editor-toolbar button:hover, 
        .editor-toolbar button.active {
            background-color: rgba(52, 152, 219, 0.1);
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: none;
        }
        
        .editor-toolbar i.separator {
            border-left: 1px solid var(--border-color);
            margin: 0 5px;
        }
        
        /* Preview pane enhancements */
        .editor-preview, 
        .editor-preview-side {
            background-color: white;
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: 0 0 var(--border-radius-sm) var(--border-radius-sm);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            line-height: 1.7;
        }
        
        .editor-preview-side {
            border-left: 1px solid var(--primary-color);
        }
        
        /* Preview content styling */
        .editor-preview h1,
        .editor-preview h2,
        .editor-preview h3,
        .editor-preview h4,
        .editor-preview h5,
        .editor-preview h6,
        .editor-preview-side h1,
        .editor-preview-side h2,
        .editor-preview-side h3,
        .editor-preview-side h4,
        .editor-preview-side h5,
        .editor-preview-side h6 {
            color: var(--secondary-color);
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.3em;
        }
        
        .editor-preview h1,
        .editor-preview-side h1 {
            font-size: 2em;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .editor-preview h2,
        .editor-preview-side h2 {
            font-size: 1.5em;
        }
        
        .editor-preview a,
        .editor-preview-side a {
            color: var(--primary-color);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color var(--transition-speed) ease;
        }
        
        .editor-preview a:hover,
        .editor-preview-side a:hover {
            border-bottom-color: var(--primary-color);
        }
        
        .editor-preview blockquote,
        .editor-preview-side blockquote {
            border-left: 4px solid var(--primary-color);
            padding-left: 1em;
            margin-left: 0;
            color: var(--text-light);
            font-style: italic;
            background-color: rgba(52, 152, 219, 0.05);
            padding: 0.5em 1em;
            border-radius: 0 var(--border-radius-sm) var(--border-radius-sm) 0;
        }
        
        .editor-preview code,
        .editor-preview-side code {
            background-color: rgba(0,0,0,0.05);
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .editor-preview pre,
        .editor-preview-side pre {
            background-color: #f8f9fa;
            padding: 1em;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--border-color);
            overflow-x: auto;
        }
        
        .editor-preview pre code,
        .editor-preview-side pre code {
            background-color: transparent;
            padding: 0;
            border-radius: 0;
        }
        
        .editor-preview table,
        .editor-preview-side table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
        }
        
        .editor-preview table th,
        .editor-preview table td,
        .editor-preview-side table th,
        .editor-preview-side table td {
            border: 1px solid var(--border-color);
            padding: 0.5em;
        }
        
        .editor-preview table th,
        .editor-preview-side table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        /* Fullscreen mode enhancements */
        .editor-toolbar.fullscreen {
            background-color: white;
            border: 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .CodeMirror.CodeMirror-fullscreen {
            border: 0;
            border-top: 1px solid var(--border-color);
        }
        
        .editor-preview-side.editor-preview-active-side {
            border-top: 1px solid var(--border-color);
        }
        
        /* Status bar styling */
        .editor-statusbar {
            padding: 8px 10px;
            color: var(--text-light);
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-top: 0;
            border-radius: 0 0 var(--border-radius-sm) var(--border-radius-sm);
            font-size: var(--font-size-xs);
        }
        
        /* Responsive design improvements */
        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: var(--spacing-sm);
            }
            
            .blog-posts {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 1 auto;
                text-align: center;
                padding: 10px;
                font-size: var(--font-size-sm);
            }
            
            .form-container {
                padding: var(--spacing-md);
            }
            
            .editor-toolbar button {
                width: 32px;
                height: 32px;
                padding: 6px;
            }
            
            .CodeMirror {
                height: 300px;
            }
            
            .radio-group {
                flex-direction: column;
                gap: var(--spacing-xs);
            }
            
            .post-actions {
                flex-wrap: wrap;
            }
            
            button {
                padding: 6px 12px;
                font-size: 13px;
            }
        }
        
        @media (max-width: 480px) {
            .tab {
                padding: 8px 5px;
                font-size: 13px;
            }
            
            .editor-toolbar {
                flex-wrap: wrap;
            }
            
            .editor-toolbar button {
                width: 28px;
                height: 28px;
                padding: 4px;
                margin: 1px;
            }
            
            .CodeMirror {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Blog Client</h1>
        <p>Interact with the Blog API</p>
    </header>

    <div class="container">
        <div id="auth-status" class="auth-status">
            <div id="auth-status-message">Not logged in</div>
            <button id="login-button" class="auth-button">Login</button>
            <button id="logout-button" class="auth-button" style="display: none;">Logout</button>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="posts">View Posts</div>
            <div class="tab" data-tab="create">Create Post</div>
            <div class="tab" data-tab="edit">Edit Post</div>
            <div class="tab" data-tab="login">Login</div>
        </div>

        <!-- Tab content for viewing posts -->
        <div id="posts-tab" class="tab-content active">
            <h2>Blog Posts</h2>
            <div id="posts-container" class="blog-posts">
                <div class="loading">Loading posts...</div>
            </div>
        </div>

        <!-- Tab content for creating posts -->
        <div id="create-tab" class="tab-content">
            <h2>Create New Post</h2>
            <div id="create-message"></div>

            <div class="form-container">
                <form id="create-post-form">
                    <div class="form-group">
                        <label for="title">Title</label>
                        <input type="text" id="title" name="title" required>
                    </div>

                    <div class="form-group">
                        <label for="slug">Slug</label>
                        <input type="text" id="slug" name="slug" required>
                    </div>

                    <div class="form-group">
                        <label>Content Format</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="content-format" value="HTML" checked> HTML
                            </label>
                            <label>
                                <input type="radio" name="content-format" value="Markdown"> Markdown
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="content">Content</label>
                        <textarea id="content" name="content" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="excerpt">Excerpt</label>
                        <textarea id="excerpt" name="excerpt"></textarea>
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="published" name="published">
                        <label for="published">Published</label>
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="featured" name="featured">
                        <label for="featured">Featured</label>
                    </div>

                    <div class="form-group">
                        <label for="tags">Tags (comma separated)</label>
                        <input type="text" id="tags" name="tags" placeholder="tag1, tag2, tag3">
                    </div>

                    <button type="submit">Create Post</button>
                </form>
            </div>
        </div>

        <!-- Tab content for editing posts -->
        <div id="edit-tab" class="tab-content">
            <h2>Edit Post</h2>
            <div id="edit-message"></div>

            <div class="form-container">
                <div id="post-selector" class="form-group">
                    <label for="post-select">Select Post to Edit</label>
                    <select id="post-select">
                        <option value="">-- Select a post --</option>
                    </select>
                </div>

                <form id="edit-post-form" style="display: none;">
                    <input type="hidden" id="edit-original-slug" name="original-slug">

                    <div class="form-group">
                        <label for="edit-title">Title</label>
                        <input type="text" id="edit-title" name="title" required>
                    </div>

                    <div class="form-group">
                        <label for="edit-slug">Slug</label>
                        <input type="text" id="edit-slug" name="slug" required>
                    </div>

                    <div class="form-group">
                        <label>Content Format</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="edit-content-format" value="HTML" checked> HTML
                            </label>
                            <label>
                                <input type="radio" name="edit-content-format" value="Markdown"> Markdown
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="edit-content">Content</label>
                        <textarea id="edit-content" name="content" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="edit-excerpt">Excerpt</label>
                        <textarea id="edit-excerpt" name="excerpt"></textarea>
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="edit-published" name="published">
                        <label for="edit-published">Published</label>
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="edit-featured" name="featured">
                        <label for="edit-featured">Featured</label>
                    </div>

                    <div class="form-group">
                        <label for="edit-tags">Tags (comma separated)</label>
                        <input type="text" id="edit-tags" name="tags" placeholder="tag1, tag2, tag3">
                    </div>

                    <button type="submit">Update Post</button>
                </form>
            </div>
        </div>
        
        <!-- Tab content for login -->
        <div id="login-tab" class="tab-content">
            <h2>Login</h2>
            <div id="login-message"></div>
            
            <div class="form-container">
                <form id="login-form" class="login-form">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    
                    <button type="submit">Login</button>
                </form>
            </div>
            
            <div id="user-info" class="user-info" style="display: none;">
                <h3>Current User</h3>
                <p><strong>Username:</strong> <span id="user-username"></span></p>
                <p><strong>Display Name:</strong> <span id="user-display-name"></span></p>
                <p><strong>Role:</strong> <span id="user-role" class="user-role"></span></p>
            </div>
        </div>
    </div>

    <script src="/static/js/api-client.js"></script>
    <!-- EasyMDE Markdown Editor JS -->
    <script src="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.js"></script>
    <script>
        // Global variables for markdown editors
        let createEditor = null;
        let editEditor = null;
        
        // Function to initialize markdown editor
        function initializeMarkdownEditor(textareaId, radioName) {
            // Get the textarea element
            const textarea = document.getElementById(textareaId);
            
            // Create the editor
            const editor = new EasyMDE({
                element: textarea,
                spellChecker: true,
                autofocus: false,
                toolbar: [
                    "bold", "italic", "heading", "|", 
                    "quote", "unordered-list", "ordered-list", "|", 
                    "link", "image", "code", "table", "|",
                    "preview", "side-by-side", "fullscreen", "|",
                    "guide"
                ],
                placeholder: "Write your content here...",
                status: ["autosave", "lines", "words", "cursor"]
            });
            
            // Add event listener to radio buttons
            document.querySelectorAll(`input[name="${radioName}"]`).forEach(radio => {
                radio.addEventListener('change', function() {
                    toggleMarkdownEditor(editor, this.value === 'Markdown', textarea);
                });
            });
            
            // Initially hide the editor if HTML is selected
            const selectedFormat = document.querySelector(`input[name="${radioName}"]:checked`).value;
            toggleMarkdownEditor(editor, selectedFormat === 'Markdown', textarea);
            
            return editor;
        }
        
        // Function to toggle between markdown editor and regular textarea
        function toggleMarkdownEditor(editor, showEditor, textarea) {
            if (showEditor) {
                // Show the markdown editor
                editor.codemirror.getWrapperElement().style.display = 'block';
                textarea.style.display = 'none';
            } else {
                // Hide the markdown editor and show the regular textarea
                editor.codemirror.getWrapperElement().style.display = 'none';
                textarea.style.display = 'block';
                
                // Copy content from editor to textarea
                textarea.value = editor.value();
            }
        }
        
        // Initialize editors when tabs are activated
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.dataset.tab;
                
                // Initialize create editor when create tab is activated
                if (tabId === 'create' && !createEditor) {
                    setTimeout(() => {
                        createEditor = initializeMarkdownEditor('content', 'content-format');
                    }, 100);
                }
                
                // Initialize edit editor when edit tab is activated and a post is selected
                if (tabId === 'edit' && document.getElementById('post-select').value && !editEditor) {
                    setTimeout(() => {
                        editEditor = initializeMarkdownEditor('edit-content', 'edit-content-format');
                    }, 100);
                }
            });
        });
    </script>
    <script>
        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and tab contents
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
            });
        });

        // Function to format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        // Function to load posts
        async function loadPosts() {
            const postsContainer = document.getElementById('posts-container');
            postsContainer.innerHTML = '<div class="loading">Loading posts...</div>';

            try {
                // Use our API client instead of fetch
                const posts = await BlogAPI.getPosts();

                if (posts.length === 0) {
                    postsContainer.innerHTML = '<div class="loading">No posts found. Create one!</div>';
                    return;
                }

                postsContainer.innerHTML = '';

                posts.forEach(post => {
                    const postElement = document.createElement('div');
                    postElement.className = 'blog-post';

                    let tagsHtml = '';
                    if (post.tags && post.tags.length > 0) {
                        tagsHtml = post.tags.map(tag => 
                            `<span class="tag">${tag.name}</span>`
                        ).join('');
                    }

                    const publishedStatus = post.published ? 'Published' : 'Draft';
                    const featuredStatus = post.featured ? ' • Featured' : '';

                    postElement.innerHTML = `
                        <h2>${post.title}</h2>
                        <div class="post-meta">${publishedStatus}${featuredStatus} • ${formatDate(post.created_at || new Date())}</div>
                        <div>${tagsHtml}</div>
                        <p>${post.excerpt || post.content.substring(0, 150)}...</p>
                        <div class="post-actions">
                            <button class="view-btn" data-slug="${post.slug}">View Details</button>
                            <button class="edit-btn" data-slug="${post.slug}">Edit</button>
                            <button class="delete-btn" data-slug="${post.slug}">Delete</button>
                        </div>
                    `;

                    postsContainer.appendChild(postElement);
                });

                // Add event listeners to view buttons
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const slug = btn.dataset.slug;
                        try {
                            // Use our API client instead of fetch
                            const post = await BlogAPI.getPost(slug);
                            alert(`Post Details:\n\nTitle: ${post.title}\nSlug: ${post.slug}\nContent: ${post.content}\nPublished: ${post.published ? 'Yes' : 'No'}\nFeatured: ${post.featured ? 'Yes' : 'No'}`);
                        } catch (error) {
                            console.error('Error fetching post details:', error);
                            alert(`Error: ${error.message}`);
                        }
                    });
                });

                // Add event listeners to edit buttons
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const slug = btn.dataset.slug;
                        // Switch to edit tab
                        document.querySelector('.tab[data-tab="edit"]').click();
                        // Select the post in the dropdown
                        const selectElement = document.getElementById('post-select');
                        selectElement.value = slug;
                        // Trigger the change event to load the post data
                        selectElement.dispatchEvent(new Event('change'));
                    });
                });

                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const slug = btn.dataset.slug;
                        if (confirm(`Are you sure you want to delete the post "${slug}"?`)) {
                            try {
                                await deletePost(slug);
                            } catch (error) {
                                // Error is already handled in deletePost function
                            }
                        }
                    });
                });

            } catch (error) {
                console.error('Error loading posts:', error);
                postsContainer.innerHTML = `<div class="error">Error loading posts: ${error.message}</div>`;
            }
        }

        // Function to create a new post
        async function createPost(postData) {
            const messageContainer = document.getElementById('create-message');
            messageContainer.innerHTML = '<div>Creating post...</div>';

            try {
                // Use our API client instead of fetch
                const result = await BlogAPI.createPost(postData);

                messageContainer.innerHTML = `<div class="success">Post created successfully!</div>`;
                document.getElementById('create-post-form').reset();

                // Switch to posts tab and reload posts
                document.querySelector('.tab[data-tab="posts"]').click();
                loadPosts();

                return result;
            } catch (error) {
                console.error('Error creating post:', error);
                messageContainer.innerHTML = `<div class="error">Error creating post: ${error.message}</div>`;
                throw error;
            }
        }

        // Function to update an existing post
        async function updatePost(slug, postData) {
            const messageContainer = document.getElementById('edit-message');
            messageContainer.innerHTML = '<div>Updating post...</div>';

            try {
                // Use our API client instead of fetch
                const result = await BlogAPI.updatePost(slug, postData);

                messageContainer.innerHTML = `<div class="success">Post updated successfully!</div>`;

                // Switch to posts tab and reload posts
                document.querySelector('.tab[data-tab="posts"]').click();
                loadPosts();

                return result;
            } catch (error) {
                console.error('Error updating post:', error);
                messageContainer.innerHTML = `<div class="error">Error updating post: ${error.message}</div>`;
                throw error;
            }
        }

        // Function to delete a post
        async function deletePost(slug) {
            try {
                // Use our API client instead of fetch
                await BlogAPI.deletePost(slug);

                // Show success message
                alert('Post deleted successfully!');

                // Reload posts
                loadPosts();

                return true;
            } catch (error) {
                console.error('Error deleting post:', error);
                alert(`Error deleting post: ${error.message}`);
                throw error;
            }
        }

        // Function to populate the post selector dropdown
        async function populatePostSelector() {
            const selectElement = document.getElementById('post-select');

            try {
                // Clear existing options except the first one
                while (selectElement.options.length > 1) {
                    selectElement.remove(1);
                }

                // Get all posts
                const posts = await BlogAPI.getPosts();

                // Add each post to the dropdown
                posts.forEach(post => {
                    const option = document.createElement('option');
                    option.value = post.slug;
                    option.textContent = post.title;
                    selectElement.appendChild(option);
                });
            } catch (error) {
                console.error('Error populating post selector:', error);
                alert(`Error loading posts: ${error.message}`);
            }
        }

        // Function to load a post into the edit form
        async function loadPostForEditing(slug) {
            const form = document.getElementById('edit-post-form');
            const messageContainer = document.getElementById('edit-message');

            if (!slug) {
                form.style.display = 'none';
                messageContainer.innerHTML = '';
                return;
            }

            messageContainer.innerHTML = '<div>Loading post...</div>';

            try {
                // Get the post
                const post = await BlogAPI.getPost(slug);

                // Populate the form
                document.getElementById('edit-original-slug').value = post.slug;
                document.getElementById('edit-title').value = post.title;
                document.getElementById('edit-slug').value = post.slug;
                document.getElementById('edit-content').value = post.content;
                document.getElementById('edit-excerpt').value = post.excerpt || '';
                document.getElementById('edit-published').checked = post.published;
                document.getElementById('edit-featured').checked = post.featured;

                // Set the content format radio button
                const contentFormat = post.content_format || 'HTML'; // Default to HTML if not specified
                const radioSelector = `input[name="edit-content-format"][value="${contentFormat}"]`;
                const radioButton = document.querySelector(radioSelector);
                if (radioButton) {
                    radioButton.checked = true;
                    
                    // Initialize or update the markdown editor if needed
                    if (contentFormat === 'Markdown') {
                        if (!editEditor) {
                            // Initialize the editor if it doesn't exist
                            setTimeout(() => {
                                editEditor = initializeMarkdownEditor('edit-content', 'edit-content-format');
                                // Need to set the content again after editor is initialized
                                editEditor.value(post.content);
                            }, 100);
                        } else {
                            // Update the editor content and show it
                            editEditor.value(post.content);
                            toggleMarkdownEditor(editEditor, true, document.getElementById('edit-content'));
                        }
                    } else if (editEditor) {
                        // Hide the markdown editor if HTML is selected
                        toggleMarkdownEditor(editEditor, false, document.getElementById('edit-content'));
                    }
                }

                // Handle tags
                if (post.tags && post.tags.length > 0) {
                    const tagNames = post.tags.map(tag => tag.name);
                    document.getElementById('edit-tags').value = tagNames.join(', ');
                } else {
                    document.getElementById('edit-tags').value = '';
                }

                // Show the form
                form.style.display = 'block';
                messageContainer.innerHTML = '';
            } catch (error) {
                console.error('Error loading post for editing:', error);
                messageContainer.innerHTML = `<div class="error">Error loading post: ${error.message}</div>`;
                form.style.display = 'none';
            }
        }

        // Event listener for form submission
        document.getElementById('create-post-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const title = document.getElementById('title').value;
            const slug = document.getElementById('slug').value;
            // Get content from markdown editor if it's active, otherwise from textarea
            let content;
            const contentFormat = document.querySelector('input[name="content-format"]:checked').value;
            if (contentFormat === 'Markdown' && createEditor) {
                content = createEditor.value();
            } else {
                content = document.getElementById('content').value;
            }
            
            const excerpt = document.getElementById('excerpt').value;
            const published = document.getElementById('published').checked;
            const featured = document.getElementById('featured').checked;
            const tagsInput = document.getElementById('tags').value;

            // Parse tags
            const tags = tagsInput.split(',')
                .map(tag => tag.trim())
                .filter(tag => tag)
                .map(tag => ({
                    name: tag,
                    slug: tag.toLowerCase().replace(/\s+/g, '-')
                }));

            const postData = {
                title,
                slug,
                content,
                content_format: contentFormat,
                excerpt: excerpt || content.substring(0, 150),
                published,
                featured,
                date: new Date().toISOString().split('T')[0],
                author: 'Blog Client User',
                image: null,
                tags,
                metadata: {}
            };

            try {
                await createPost(postData);
            } catch (error) {
                // Error is already handled in createPost function
            }
        });

        // Auto-generate slug from title
        document.getElementById('title').addEventListener('input', (e) => {
            const title = e.target.value;
            const slug = title.toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .replace(/\s+/g, '-');

            document.getElementById('slug').value = slug;
        });

        // Auto-generate slug from title in edit form
        document.getElementById('edit-title').addEventListener('input', (e) => {
            const title = e.target.value;
            const slug = title.toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .replace(/\s+/g, '-');

            document.getElementById('edit-slug').value = slug;
        });

        // Event listener for edit form submission
        document.getElementById('edit-post-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const originalSlug = document.getElementById('edit-original-slug').value;
            const title = document.getElementById('edit-title').value;
            const slug = document.getElementById('edit-slug').value;
            
            // Get content from markdown editor if it's active, otherwise from textarea
            let content;
            const contentFormat = document.querySelector('input[name="edit-content-format"]:checked').value;
            if (contentFormat === 'Markdown' && editEditor) {
                content = editEditor.value();
            } else {
                content = document.getElementById('edit-content').value;
            }
            
            const excerpt = document.getElementById('edit-excerpt').value;
            const published = document.getElementById('edit-published').checked;
            const featured = document.getElementById('edit-featured').checked;
            const tagsInput = document.getElementById('edit-tags').value;

            // Parse tags
            const tags = tagsInput.split(',')
                .map(tag => tag.trim())
                .filter(tag => tag)
                .map(tag => ({
                    name: tag,
                    slug: tag.toLowerCase().replace(/\s+/g, '-')
                }));

            const postData = {
                title,
                slug,
                content,
                content_format: contentFormat,
                excerpt: excerpt || content.substring(0, 150),
                published,
                featured,
                date: new Date().toISOString().split('T')[0],
                author: 'Blog Client User',
                image: null,
                tags,
                metadata: {}
            };

            try {
                await updatePost(originalSlug, postData);
                // Reset the form and hide it
                document.getElementById('edit-post-form').reset();
                document.getElementById('edit-post-form').style.display = 'none';
                document.getElementById('post-select').value = '';
            } catch (error) {
                // Error is already handled in updatePost function
            }
        });

        // Event listener for post selector change
        document.getElementById('post-select').addEventListener('change', (e) => {
            const slug = e.target.value;
            loadPostForEditing(slug);
        });

        // Event listener for tab changes to populate the post selector
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                if (tab.dataset.tab === 'edit') {
                    populatePostSelector();
                }
            });
        });

        // Authentication functions
        
        // Update authentication status UI
        function updateAuthStatus() {
            const authStatusMessage = document.getElementById('auth-status-message');
            const loginButton = document.getElementById('login-button');
            const logoutButton = document.getElementById('logout-button');
            const userInfo = document.getElementById('user-info');
            
            if (BlogAPI.isAuthenticated()) {
                const user = BlogAPI.getCurrentUser();
                
                // Update auth status bar
                authStatusMessage.textContent = `Logged in as ${user.username}`;
                loginButton.style.display = 'none';
                logoutButton.style.display = 'inline-block';
                
                // Update user info in login tab
                document.getElementById('user-username').textContent = user.username;
                document.getElementById('user-display-name').textContent = user.displayName;
                document.getElementById('user-role').textContent = user.role;
                
                // Show user info and hide login form
                document.getElementById('login-form').style.display = 'none';
                userInfo.style.display = 'block';
                
                // Clear login message
                document.getElementById('login-message').innerHTML = '';
            } else {
                // Update auth status bar
                authStatusMessage.textContent = 'Not logged in';
                loginButton.style.display = 'inline-block';
                logoutButton.style.display = 'none';
                
                // Hide user info and show login form
                document.getElementById('login-form').style.display = 'block';
                userInfo.style.display = 'none';
            }
        }
        
        // Handle login form submission
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const messageContainer = document.getElementById('login-message');
            
            messageContainer.innerHTML = '<div>Logging in...</div>';
            
            try {
                await BlogAPI.login(username, password);
                
                // Update auth status
                updateAuthStatus();
                
                messageContainer.innerHTML = '<div class="success">Login successful!</div>';
                
                // Reset form
                document.getElementById('login-form').reset();
            } catch (error) {
                console.error('Login failed:', error);
                messageContainer.innerHTML = `<div class="error">Login failed: ${error.message}</div>`;
            }
        });
        
        // Handle login button click
        document.getElementById('login-button').addEventListener('click', () => {
            // Switch to login tab
            document.querySelector('.tab[data-tab="login"]').click();
        });
        
        // Handle logout button click
        document.getElementById('logout-button').addEventListener('click', () => {
            BlogAPI.logout();
            updateAuthStatus();
            
            // Show message
            document.getElementById('login-message').innerHTML = '<div class="success">Logged out successfully!</div>';
        });
        
        // Check authentication status when page loads
        window.addEventListener('load', () => {
            loadPosts();
            updateAuthStatus();
        });
    </script>
</body>
</html>
